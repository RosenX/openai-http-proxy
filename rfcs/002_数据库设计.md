# 数据库设计

- 主要内容: 设计数据库表结构
- Start Date: 2023-03-18

## Summary

将数据表分为user和content两个scehma, user schema中包含用户相关的表，content schema中包含content相关表。

## Motivation

因为拆分了多个服务，要隔离不同服务的权限

## Guide-level explanation
### Database Schema
```sql
CREATE SCHEMA content;

CREATE TABLE content.feed_profile {
    id SERIAL PRIMARY KEY,
    url VARCHAR(200) NOT NULL UNIQUE,
    name VARCHAR(50),
    logo VARCHAR(200),
    description VARCHAR(300),
    icon VARCHAR(300),
    category_algo VARCHAR(50),
    tags_algo VARCHAR(50)[],
    COMMENT ON COLUMN tags IS "算法标签",
    COMMENT ON COLUMN category IS "算法分类"
}

CREATE TABLE content.content {
    id SERIAL PRIMARY KEY,
    feed_id INTEGER,
    title VARCHAR(50) NOT NULL UNIQUE,
    publish_time TIMESTAMP(0) WITH TIME ZONE,
    authors VARCHAR(50)[],
    link VARCHAR(200),
    content TEXT,
    cover VARCHAR(200),
    summary TEXT,
    summary_algo TEXT,
    tags_algo VARCHAR(50)[],
    category_algo VARCHAR(50),
    md5 CHAR(32) NOT NULL UNIQUE,

    COMMENT ON COLUMN md5 IS "title+content md5 32位",
    COMMENT ON COLUMN category IS "算法分类",
    COMMENT ON COLUMN tags IS "算法标签",
    COMMENT ON COLUMN summary IS "算法摘要"
}

CREATE SCHEMA user;

CREATE TYPE user.pro_level AS ENUM('Normal', 'PRO', 'SPro');

CREATE TABLE user.user_information {
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(200) NOT NULL,
    pro_level user.pro_level DEFAULT 'Normal',
    created_time TIMESTAMP(0) WITH TIME ZONE NOT NULL,
    pro_end_time TIMESTAMP(0) WITH TIME ZONE NOT NULL
}

CREATE INDEX user_information_email_idx ON user.user_information (email);

CREATE TABLE user.user_feed {
    id SERIAL,
    user_id INTEGER NOT NULL,
    feed_id INTEGER NOT NULL,
    name VARCHAR(50),
    logo VARCHAR(200),
    description VARCHAR(300),
    created_time TIMESTAMP NOT NULL,
    group VARCHAR(50),
    tags VARCHAR(50)[],
    PRIMARY KEY (user_id, feed_id),
}

CREATE INDEX user_feed_user_id_idx ON user.user_feed (user_id);

CREATE TABLE user.user_content {
    id SERIAL,
    content_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    tags VARCHAR(50)[],
    category VARCHAR(50),
    notes TEXT

    PRIMARY KEY (content_id, user_id),
}

CREATE INDEX user_content_id_idx ON user.user_content (id);
CREATE INDEX user_content_user_id_idx ON user.user_content (user_id);
```

## Reference-level explanation

TBD

## Drawbacks

网络带宽消耗会增加，因为多了一个服务。当然也可以部署到同一台机器。

## Rationale and alternatives

N/A

## Prior art

N/A

## Unresolved questions

TBD

## Future possibilities

TBD
